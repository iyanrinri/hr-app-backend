generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        BigInt    @id @default(autoincrement())
  email     String    @unique
  password  String
  role      Role      @default(EMPLOYEE)
  isDeleted Boolean   @default(false)
  deletedAt DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  employee  Employee?

  @@map("users")
}

model Employee {
  id             BigInt          @id @default(autoincrement())
  userId         BigInt          @unique
  firstName      String
  lastName       String
  position       String
  department     String
  joinDate       DateTime
  baseSalary     Decimal
  managerId      BigInt?
  isDeleted      Boolean         @default(false)
  deletedAt      DateTime?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  attendanceLogs AttendanceLog[]
  attendances    Attendance[]
  user           User            @relation(fields: [userId], references: [id])
  leaveRequests  LeaveRequest[]
  payrolls       Payroll[]
  manager        Employee?       @relation("EmployeeHierarchy", fields: [managerId], references: [id])
  subordinates   Employee[]      @relation("EmployeeHierarchy")

  @@map("employees")
}

model Attendance {
  id                 BigInt           @id @default(autoincrement())
  employeeId         BigInt
  attendancePeriodId BigInt
  date               DateTime         @db.Date
  checkIn            DateTime?
  checkOut           DateTime?
  checkInLocation    String?
  checkOutLocation   String?
  workDuration       Int?
  status             AttendanceStatus @default(ABSENT)
  notes              String?
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  attendancePeriod   AttendancePeriod @relation(fields: [attendancePeriodId], references: [id])
  employee           Employee         @relation(fields: [employeeId], references: [id])

  @@unique([employeeId, date])
  @@map("attendances")
}

model AttendanceLog {
  id                 BigInt           @id @default(autoincrement())
  employeeId         BigInt
  attendancePeriodId BigInt
  type               AttendanceType
  timestamp          DateTime         @default(now())
  location           String
  ipAddress          String?
  userAgent          String?
  notes              String?
  createdAt          DateTime         @default(now())
  attendancePeriod   AttendancePeriod @relation(fields: [attendancePeriodId], references: [id])
  employee           Employee         @relation(fields: [employeeId], references: [id])

  @@map("attendance_logs")
}

model AttendancePeriod {
  id                         BigInt          @id @default(autoincrement())
  name                       String
  startDate                  DateTime        @db.Date
  endDate                    DateTime        @db.Date
  workingDaysPerWeek         Int             @default(5)
  workingHoursPerDay         Int             @default(8)
  workingStartTime           String          @default("09:00")
  workingEndTime             String          @default("17:00")
  allowSaturdayWork          Boolean         @default(false)
  allowSundayWork            Boolean         @default(false)
  lateToleranceMinutes       Int             @default(15)
  earlyLeaveToleranceMinutes Int             @default(15)
  isActive                   Boolean         @default(true)
  description                String?
  createdBy                  BigInt
  createdAt                  DateTime        @default(now())
  updatedAt                  DateTime        @updatedAt
  attendanceLogs             AttendanceLog[]
  attendances                Attendance[]
  holidays                   Holiday[]

  @@map("attendance_periods")
}

model Holiday {
  id                 BigInt            @id @default(autoincrement())
  attendancePeriodId BigInt?
  name               String
  date               DateTime          @db.Date
  isNational         Boolean           @default(false)
  isRecurring        Boolean           @default(false)
  description        String?
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt
  attendancePeriod   AttendancePeriod? @relation(fields: [attendancePeriodId], references: [id])

  @@map("holidays")
}

model LeaveRequest {
  id         BigInt      @id @default(autoincrement())
  employeeId BigInt
  startDate  DateTime
  endDate    DateTime
  reason     String
  status     LeaveStatus @default(PENDING)
  approvedBy BigInt?
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  employee   Employee    @relation(fields: [employeeId], references: [id])

  @@map("leave_requests")
}

model Payroll {
  id          BigInt   @id @default(autoincrement())
  employeeId  BigInt
  periodStart DateTime
  periodEnd   DateTime
  baseSalary  Decimal
  deductions  Decimal  @default(0)
  bonuses     Decimal  @default(0)
  netSalary   Decimal
  isPaid      Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  employee    Employee @relation(fields: [employeeId], references: [id])

  @@map("payrolls")
}

model Setting {
  id          BigInt         @id @default(autoincrement())
  key         String         @unique
  value       String
  dataType    SettingDataType @default(STRING)
  category    SettingCategory @default(GENERAL)
  isPublic    Boolean        @default(false)
  description String?
  createdBy   BigInt
  updatedBy   BigInt
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  @@map("settings")
}

enum Role {
  SUPER
  HR
  MANAGER
  EMPLOYEE
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  EXCUSED
}

enum AttendanceType {
  CLOCK_IN
  CLOCK_OUT
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
}

enum SettingDataType {
  STRING
  INTEGER
  DECIMAL
  BOOLEAN
  JSON
  EMAIL
  URL
  DATE
  DATETIME
  TIME
  PASSWORD
}

enum SettingCategory {
  GENERAL
  COMPANY
  ATTENDANCE
  LEAVE
  PAYROLL
  NOTIFICATION
  SECURITY
  INTEGRATION
}
