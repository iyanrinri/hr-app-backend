
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  SUPER
  HR
  MANAGER
  EMPLOYEE
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  EXCUSED
}

enum AttendanceType {
  CLOCK_IN
  CLOCK_OUT
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
}

model User {
  id        BigInt   @id @default(autoincrement())
  email     String   @unique
  password  String
  role      Role     @default(EMPLOYEE)
  employee  Employee?
  isDeleted Boolean  @default(false)
  deletedAt DateTime?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

model Employee {
  id               BigInt           @id @default(autoincrement())
  userId           BigInt           @unique
  user             User             @relation(fields: [userId], references: [id])
  firstName        String
  lastName         String
  position         String
  department       String
  joinDate         DateTime
  baseSalary       Decimal
  attendances      Attendance[]
  attendanceLogs   AttendanceLog[]
  leaveRequests    LeaveRequest[]
  payrolls         Payroll[]
  isDeleted        Boolean          @default(false)
  deletedAt        DateTime?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt

  @@map("employees")
}

model Attendance {
  id               BigInt           @id @default(autoincrement())
  employeeId       BigInt
  employee         Employee         @relation(fields: [employeeId], references: [id])
  attendancePeriodId BigInt
  attendancePeriod AttendancePeriod @relation(fields: [attendancePeriodId], references: [id])
  date             DateTime         @db.Date
  checkIn          DateTime?
  checkOut         DateTime?
  checkInLocation  String?          // JSON string for coordinates {lat, lng, address}
  checkOutLocation String?          // JSON string for coordinates {lat, lng, address}
  workDuration     Int?             // Duration in minutes
  status           AttendanceStatus @default(ABSENT)
  notes            String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt

  @@unique([employeeId, date])
  @@map("attendances")
}

model AttendanceLog {
  id               BigInt          @id @default(autoincrement())
  employeeId       BigInt
  employee         Employee        @relation(fields: [employeeId], references: [id])
  attendancePeriodId BigInt
  attendancePeriod AttendancePeriod @relation(fields: [attendancePeriodId], references: [id])
  type             AttendanceType
  timestamp        DateTime        @default(now())
  location         String          // JSON string for coordinates {lat, lng, address}
  ipAddress        String?
  userAgent        String?
  notes            String?
  createdAt        DateTime        @default(now())

  @@map("attendance_logs")
}

model AttendancePeriod {
  id               BigInt          @id @default(autoincrement())
  name             String          // e.g., "January 2024", "Q1 2024"
  startDate        DateTime        @db.Date
  endDate          DateTime        @db.Date
  workingDaysPerWeek Int           @default(5) // Monday to Friday
  workingHoursPerDay Int           @default(8)
  isActive         Boolean         @default(true)
  description      String?
  attendances      Attendance[]
  attendanceLogs   AttendanceLog[]
  holidays         Holiday[]
  createdBy        BigInt          // User ID who created this period
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt

  @@map("attendance_periods")
}

model Holiday {
  id               BigInt           @id @default(autoincrement())
  attendancePeriodId BigInt?
  attendancePeriod AttendancePeriod? @relation(fields: [attendancePeriodId], references: [id])
  name             String
  date             DateTime         @db.Date
  isNational       Boolean          @default(false) // National holiday vs company holiday
  isRecurring      Boolean          @default(false) // e.g., Christmas every year
  description      String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt

  @@map("holidays")
}

model LeaveRequest {
  id          BigInt      @id @default(autoincrement())
  employeeId  BigInt
  employee    Employee    @relation(fields: [employeeId], references: [id])
  startDate   DateTime
  endDate     DateTime
  reason      String
  status      LeaveStatus @default(PENDING)
  approvedBy  BigInt?     // User ID of approver
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  @@map("leave_requests")
}

model Payroll {
  id          BigInt   @id @default(autoincrement())
  employeeId  BigInt
  employee    Employee @relation(fields: [employeeId], references: [id])
  periodStart DateTime
  periodEnd   DateTime
  baseSalary  Decimal
  deductions  Decimal  @default(0)
  bonuses     Decimal  @default(0)
  netSalary   Decimal
  isPaid      Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("payrolls")
}



